<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
  <title>问卷调查</title>
  <!-- 引入你的外部样式 -->
  <link rel="stylesheet" href="/css/demo.css">
</head>

<body>
  <audio id="music" src="/music/music.mp3"></audio>
  <audio id="musichp" src="/music/music2.mp3" loop></audio>

  <div class="container">
    <div id="question"></div>
    <div class="input-container">
      <input type="text" id="answer" autocomplete="off" placeholder="请输入你的答案...">
    </div>
    <button id="nextBtn" class="ui-btn">下一个</button>
  </div>

  <div class="youscreen">
    <h1 class="yes-text">我也喜欢你~</h1>
    <img src="/picture/gif.gif" alt="HAPI" class="yes-image">
  </div>

  <div class="popup" id="welcomePopup">
    <div class="popup-box">
      一定要说真话哦<br/>......<br/>最喜欢你了
      <br><br>
      <button class="ui-btn" onclick="closeWelcome()">关闭</button>
    </div>
  </div>

  <script>
    /* ===== 配置 ===== */
    const messagest   = "一定要说真话哦<br/>......<br/>最喜欢你了";
    const answerst    = "你<br/>喜欢你<br/>是你<br/>you";
    const questionst  = "最喜欢的歌是什么?<br/>最喜欢的食物是什么?<br/>最喜欢的颜色是哪个?<br/>最喜欢的季节是什么?<br/>最喜欢的动物是什么?<br/>最喜欢的人是谁?";
    const textst      = "为什么不填我<br/>要永远在一起啊<br/>看着我...只准看着我<br/>我一直注视着你<br/>拒绝是新型的告白对吧对吧<br/>为什么要逃呢<br/>我知道你喜欢我的 对吧<br/>好痛...但更痛的是心";
    const textstw     = "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈<br/>我最愛你了....<br/>你以为你能逃得掉吗<br/>没用的...没用的...没用的...<br/>一切都已经太迟了<br/>只准喜歡我....<br/>我們註定是要在一起的<br/>爱你...你...爱...爱你...";
    const opportunity = "再给你一次机会";

    const questions = questionst.split('<br/>');
    let currentStep = 0;
    const music  = document.getElementById('music');
    const musichp= document.getElementById('musichp');

    /* ===== 页面初始化 ===== */
    window.addEventListener('load', () => {
      document.getElementById('welcomePopup').style.display = 'flex';
    });
    function closeWelcome(){
      document.getElementById('welcomePopup').style.display = 'none';
      document.getElementById('answer').classList.add('animate');
    }
    function updateQuestion(){
      document.getElementById('question').textContent = questions[currentStep];
      document.getElementById('answer').value = '';
      document.getElementById('answer').focus();
    }
    document.getElementById('nextBtn').addEventListener('click', () => {
      const val = document.getElementById('answer').value.trim();
      if (!val) {
        alert('请输入答案！');
        return;
      }
      if (currentStep === questions.length - 1) {
        checkFinalAnswer(val);
        return;
      }
      currentStep++;
      updateQuestion();
    });
    function checkFinalAnswer(val) {
      const ok = answerst.split('<br/>').some(v => val.toLowerCase().includes(v.toLowerCase()));
      if (ok) {
        document.querySelector('.container').style.display = 'none';
        document.querySelector('.youscreen').style.display = 'flex';
        musichp.play();
      } else {
        triggerApocalypse();
      }
    }
    updateQuestion();

    /* ===== 病娇特效（调用你 CSS 里的类 & 红色系） ===== */
    let retryCount = 0;
    let isApocalypse = false;
    let bloodTimerIDs = [];

    function triggerApocalypse() {
      music.play();
      isApocalypse = true;
      document.body.classList.add('apocalypse-mode', 'apocalypse-shake');

      /* 血雨 */
      const rainBox = document.createElement('div');
      rainBox.className = 'blood-rain';
      document.body.appendChild(rainBox);
      const rainID = setInterval(() => {
        const drop = document.createElement('div');
        drop.className = 'blood-drop';
        drop.style.left = Math.random() * 100 + '%';
        drop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
        rainBox.appendChild(drop);
        setTimeout(() => drop.remove(), 1000);
      }, 30);
      bloodTimerIDs.push(rainID);

      /* 血字 & 血盒 */
      const texts = textstw.split('<br/>');
      const textID = setInterval(() => {
        if (!isApocalypse) return;
        const t = document.createElement('div');
        t.className = 'blood-text';
        t.style.left = Math.random() * 90 + '%';
        t.style.top  = Math.random() * 90 + '%';
        t.style.fontSize = (Math.random() * 10 + 18) + 'px';
        t.textContent = texts[Math.floor(Math.random() * texts.length)];
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 8000);
      }, 400);
      bloodTimerIDs.push(textID);

      /* 10 秒后停音乐、清场、再给你一次机会 */
      setTimeout(() => {
        clearInterval(rainID);
        clearInterval(textID);
        music.pause();
        music.currentTime = 0;
        rainBox.remove();
        document.body.classList.remove('apocalypse-mode', 'apocalypse-shake');
        document.querySelectorAll('.blood-text,.blood-splatter').forEach(el => el.remove());

        const retry = document.createElement('div');
        retry.className = 'retry-text';
        retry.textContent = opportunity;
        document.body.appendChild(retry);
        setTimeout(() => retry.remove(), 3000);

        retryCount++;
        updateQuestion();
        isApocalypse = false;
      }, 10000);
    }
  </script>
</body>
</html>
